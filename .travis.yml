dist: trusty
language: ruby
rvm:
- 2.3.1

addons:
  postgresql: "9.4"
  code_climate:
    repo_token: 4c4a4fd1f96cc88b1faf699a76980d60dc9defa35e6db87572c197411506e4f7

deploy:
  provider: heroku
  api_key:
    secure: bhfGFajpFcdjNjwxAa7PunpkRgIAKCLM40rFByqSxr3NBiIOhICtyI6rAJG60SXCSLz7S+HYR+f4MyciLy2JEBg/b8CFHV4zHtHQ9LMJRlS0jsOEgGYdYHx6WkqIteK9Vu+mFaAEGb+eWeRfGeXvgcrCa5Xf+xJJieJtlLNWMgM=
  app: come-malaka-expenses
  on:
    repo: Elyasin/Come-Malaka-Expenses

before_script:
  - sudo apt-get purge mongodb*
  - sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 2930ADAE8CAF5059EE73BB4B58712A2291FA4AD5
  - echo "deb [ arch=amd64 ] https://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/3.6 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-3.6.list
  - sudo apt-get update
  - sudo apt-get install -y mongodb-org=3.6.6 mongodb-org-server=3.6.6 mongodb-org-shell=3.6.6 mongodb-org-mongos=3.6.6 mongodb-org-tools=3.6.6
  - sleep 15
  - psql -c "create role tester with createdb login password 'tester'" -U postgres
  - bundle exec rake db:setup


after_success:
  - bundle exec codeclimate-test-reporter
